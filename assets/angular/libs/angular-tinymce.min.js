angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,t,n,i,l,o){o=o||{};var r=0,a="tinymce_content";return o.baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],link:function(s,c,u,m){function d(e){e?(f(),g&&g.getBody().setAttribute("contenteditable",!1)):(f(),g&&g.getBody().setAttribute("contenteditable",!0))}function f(){g||(g=tinymce.get(u.id))}if(i.tinymce){var p,v,g,b=m[0],$=m[1]||null,y=function(t){var n=t.getContent({format:v.format}).trim();n=l.trustAsHtml(n),b.$setViewValue(n),e.$$phase||s.$apply()};u.$set("id",a+"-"+r++),p={},angular.extend(p,s.$eval(u.uiTinymce)),v={setup:function(e){e.on("init",function(){b.$render(),b.$setPristine(),$&&$.$setPristine()}),e.on("ExecCommand",function(){e.save(),y(e)}),e.on("change",function(t){e.save(),y(e)}),e.on("blur",function(){c[0].blur()}),e.on("ObjectResized",function(e){e.save(),y(e)}),e.on("remove",function(){c.remove()}),p.setup&&p.setup(e,{updateView:y})},format:"raw",selector:"#"+u.id,convert_urls:!1,relative_urls:!0,fix_list_elements:!0,fontsize_formats:"8pt 10pt 12pt 14pt 18pt 24pt 36pt",force_p_newlines:!0,force_hex_style_colors:!0,invalid_elements:"font span",keep_styles:!1,visual:!0,plugins:["lists link table","wordcount code","directionality"],toolbar1:"pastetext removeformat | undo redo | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify styleselect | bullist numlist outdent indent | link code",image_advtab:!0,target_list:[{title:"Same page",value:"_self"},{title:"New page",value:"_blank"}],style_formats:[{title:"H1",block:"h1"},{title:"H2",block:"h2"},{title:"P.h2",block:"p",inline:"p",classes:"h2"},{title:"H3",block:"h3"},{title:"P.h3",block:"p",inline:"p",classes:"h3"},{title:"H4",block:"h4"},{title:"P.h4",block:"p",inline:"p",classes:"h4"}],paste_as_text:!0,menubar:!1,browser_spellcheck:!0,dialog_type:"modal"},angular.extend(v,o,p),n(function(){tinymce.init(v),d(s.$eval(u.ngDisabled))}),b.$formatters.unshift(function(e){return e?l.trustAsHtml(e):""}),b.$parsers.unshift(function(e){return e?l.getTrustedHtml(e):""}),b.$render=function(){f();var e=b.$viewValue?l.getTrustedHtml(b.$viewValue):"";g&&g.getDoc()&&(g.setContent(e),g.fire("change"))},u.$observe("disabled",d),s.$on("$tinymce:refresh",function(e,n){var i=u.id;if(angular.isUndefined(n)||n===i){var l=c.parent(),o=c.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),l.append(t(o)(s))}}),s.$on("$destroy",function(){f(),g&&(g.remove(),g=null)})}}}}]);